<!DOCTYPE html>
<html>
<head>
  <title>testCoverage Report </title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/black-tie/jquery-ui.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
	  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><!--<script>
        $(function() {
          $( "#tabs" ).tabs().addClass( "ui-tabs-vertical ui-helper-clearfix" );
          $( "#tabs li" ).removeClass( "ui-corner-top" ).addClass( "ui-corner-left" );
        });
    </script>-->
    <style>
	.footer {
		padding-top: 19px;
		color: #777;
		border-top: 1px solid #e5e5e5;
	}
  .btn,
  .nav-pills>li>a,
  .ui-corner-all,
  .ui-corner-top,
  .ui-corner-left,
  .ui-corner-tl {
    border-radius: 0;
  }
  .ui-widget-header {
    border: 1px solid #aaa;
  	background: #FAA531;
  	color: #222222;
  	font-weight: bold;
  }
  .fail {
    color: #A94442;
  background-color: #F2DEDE;
  }
  .pass {
    color: #3C763D;
  background-color: #DFF0D8;
  }
    </style>
</head>
<body>
  <script>
  var tagList = ["1_97","1_111","1_114","1_117","1_125","1_182","1_218","1_232","1_235","1_238","1_246","1_303","1_339","1_353","1_356","1_359","1_407","1_443","1_457","1_460","1_463","1_511","1_547","1_561","1_564","1_567","1_615","1_651","1_665","1_668","1_676","1_722","1_758","1_772","1_805","1_862","1_872","1_882","1_892","1_904","1_907","1_921","1_924","1_938","1_941","1_955","1_958","1_972","1_975","1_989","1_992","1_1006","1_1009","1_1025","1_1028","1_1088","1_1091","1_1099","1_1137","1_1140","1_1144","1_1182","1_1208","1_1213","1_1216","1_1230","1_1233","1_1236","1_1260","1_1263","1_1293","1_1298","1_1305","1_1308","1_1339","1_1342","1_1353","1_1356","1_1391","1_1394","1_1416","1_1419","1_1427","1_1430","1_1433","1_1484","1_1503","1_1506","1_1514","1_1517","1_1564","1_1574","1_1610","1_1641","1_1644","1_1682","2_29","2_32","2_36","2_53","2_56","2_60","2_77","2_80","2_84","2_101","2_104","2_108","2_125","2_128","2_132","2_149","2_152","2_156","2_181","2_188","2_198","2_211","2_214","2_217","2_237","2_240","2_254","2_257","2_271","2_274","2_288","2_291","2_305","2_308","2_332","2_351"];
var sumTags = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
var allTags = [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
var coverage = [[[32,64],[0,36],[0,0],[0,0]]];
var all_coverage = [[32,64],[0,36],[0,0],[0,0]];
var sumAllTraces = {"0":132,"1":32};
docolor = function(j, bb) {
// $("#t_" + tagList[j]).css("backgroundColor", bb ? "lightgreen" : "lightpink");
    if(bb > 0) {
        $("#t_" + tagList[j]).removeClass("fail").addClass("pass");
	} else {
        $("#t_" + tagList[j]).removeClass("pass").addClass("fail");
    }
};
pbsummed = function(j, cov) {
    pct = 100 * (cov[0] / (cov[0] + cov[1]));
    $("#progress-" + (j + 1)).progressbar({
        value: pct
    });
};
$(document).ready(function() {
    $.each(sumTags, docolor);
    $.each(all_coverage, pbsummed);
    $("#trace_all").click(function() {
        $.each(sumTags, docolor);
        $.each(all_coverage, pbsummed)
    });
    $.each(allTags, function(i, dum) {
        $("#run_" + (i + 1)).click(
            function() {
                $.each(allTags[i], docolor);
                $.each(coverage[i], function(j, cov) {
                    pct = 100 * (cov[0] / (cov[0] + cov[1]));
                    $("#progress-" + (j + 1)).progressbar({
                        value: pct
                    });
                })
            });
    });

    //This will only run if jQuery has loaded.
    $(".internet-connectivity").hide();
});
$( document ).ready(function() {
  $(".internet-connectivity").hide();
})
  </script>
  <div class="alert alert-danger internet-connectivity" role="alert"><h1><strong>Warning:</strong> An internet connection is required to load external assets.</h1></div>
  <div class="container">
  <div class="jumbotron">
    <h1>testCoverage Report <small></small></h1>
  </div>
  <h2>Summary</h2>
<!-- html table generated in R 3.1.2 by xtable 1.7-4 package -->
<!-- Wed Feb 11 01:08:05 2015 -->
<table class="table table-bordered">
<tr> <th>  </th> <th> Total # Tracepoints </th> <th> # Executed </th> <th> % Coverage </th>  </tr>
  <tr> <td align="right"> 1 </td> <td> 132 </td> <td> 32 </td> <td>  24% </td> </tr>
   </table>
<h2>testthat Tests</h2>
	<button type="button" class="btn btn-default" id="trace_all">All Tests</button>&nbsp;<button type='button' class='btn btn-default' id='run_1'>testEncodeDownloder.R</button>&nbsp;<h2>Resource Files</h2><div class="row">
       <div class="col-md-4">
        <ul class="nav nav-pills nav-stacked" role="tablist"><li class="active"><a role="tab" data-toggle="tab" href="#tabs-1">encode.R</a><div id="progress-1" ></div></li>
<li class=""><a role="tab" data-toggle="tab" href="#tabs-2">server.R</a><div id="progress-2" ></div></li>
<li class=""><a role="tab" data-toggle="tab" href="#tabs-3">ui.R</a><div id="progress-3" ></div></li>
<li class=""><a role="tab" data-toggle="tab" href="#tabs-4">www</a><div id="progress-4" ></div></li>
</ul>
    </div> 
    <div class="col-md-8">
    <div class="tab-content"><div class="tab-pane active" id="tabs-1"><pre>#' @title Download data from ENCODDE project
#' @description
#' @param searchTerm - bone chip
#' @param iType -   "experiment" "publication" "software" ""antibody_lot" "web"
#' @param iTarget - "transcription factor" "RNA binding protein" "tag" "histone modification"
#' @param iSample - "tissue" "primary cell"
#' @param iFType  - "bam" "bigWig" "bed_broadPeak" "broadPeak" "fastq"
#' @param assay - "ChIP-seq" "RIP-chip" "Repli-chip" 
#' @param assembly - "hg19" "mm9"
#' @param output - path to save files
#' @examples
#' encodeDownload("bone chip",
#'                "experiment",
#'                "transcription factor", 
#'                "encodeDownload"
#'                )
#' @seealso \url{https://www.encodeproject.org/search/}
#' @seealso \url{https://www.encodeproject.org/help/rest-api/}
#' 
<span id="t_1_58">library(RCurl)</span>
<span id="t_1_70">library(rjson)</span>

<span id="t_1_84">formatTarget</span> &lt;- function(iTarget){
  if(!<span id="t_1_97">is.null(iTarget)</span>){
    <span id="t_1_111">return (<span id="t_1_114">paste(<span id="t_1_117">paste ("target.investigated_as", <span id="t_1_125">gsub(" ","%20",iTarget)</span>,sep = "=")</span>, collapse = "&")</span>)</span>
  }
  <span id="t_1_182">return(NULL)</span>
}

<span id="t_1_205">formatSample</span> &lt;- function(iSample){
  if(!<span id="t_1_218">is.null(iSample)</span>){
    <span id="t_1_232">return (<span id="t_1_235">paste(<span id="t_1_238">paste ("replicates.library.biosample.biosample_type", <span id="t_1_246">gsub(" ", "%20", iSample)</span>, sep = "=")</span>, collapse = "&")</span>)</span>
  }
  <span id="t_1_303">return (NULL)</span>
}

<span id="t_1_326">formatFType</span> &lt;- function(iFType){
  if(!<span id="t_1_339">is.null(iFType)</span>){
    <span id="t_1_353">return (<span id="t_1_356">paste(<span id="t_1_359">paste ("files.file_format", iFType, sep = "=")</span>, collapse = "&")</span>)</span>
  }
  <span id="t_1_407">return (NULL)</span>
} 

<span id="t_1_430">formatAssay</span> &lt;- function(iAssay){
  if(!<span id="t_1_443">is.null(iAssay)</span>){
    <span id="t_1_457">return (<span id="t_1_460">paste(<span id="t_1_463">paste ("assay_term_name", iAssay, sep = "=")</span>, collapse = "&")</span>)</span>
  }
  <span id="t_1_511">return (NULL)</span>
}

<span id="t_1_534">formatAssembly</span> &lt;- function(iAssembly){
  if(!<span id="t_1_547">is.null(iAssembly)</span>){
    <span id="t_1_561">return (<span id="t_1_564">paste(<span id="t_1_567">paste ("assembly", iAssembly, sep = "=")</span>, collapse = "&")</span>)</span>
  }
  <span id="t_1_615">return(NULL)</span>
}

<span id="t_1_638">formatSearch</span> &lt;- function(iSearch){
  if(!<span id="t_1_651">is.null(iSearch)</span>){
    <span id="t_1_665">return (<span id="t_1_668">paste ("searchTerm",  <span id="t_1_676">gsub(" ","+",iSearch)</span>, sep="=")</span>)</span> 
  }
  <span id="t_1_722">return (NULL)</span>
}

<span id="t_1_745">formatType</span> &lt;- function(iType){
  if(!<span id="t_1_758">is.null(iType)</span>){
    <span id="t_1_772">paste ("type", iType, sep="=")</span>
  }
  <span id="t_1_805">return (NULL)</span>
}

<span id="t_1_828">encodeDownload</span> &lt;- function(iSearch, iType, iTarget, iSample, iFType, iAssay, iAssembly, iOut) {
  
  # Constant parameters
  <span id="t_1_862">encodePath</span>  = "https://www.encodeproject.org"
  <span id="t_1_872">searchPath</span>  = "/search/"
  <span id="t_1_882">format</span>      = "format=json"
  <span id="t_1_892">frame</span>       = "frame=embedded"
  
  <span id="t_1_904">searchTerm</span> = <span id="t_1_907">formatSearch   ( iSearch  )</span> 
  <span id="t_1_921">type</span>       = <span id="t_1_924">formatType     ( iType    )</span>
  <span id="t_1_938">target</span>     = <span id="t_1_941">formatTarget   ( iTarget  )</span>
  <span id="t_1_955">biosample</span>  = <span id="t_1_958">formatSample   ( iSample  )</span>
  <span id="t_1_972">fType</span>      = <span id="t_1_975">formatFType    ( iFType   )</span>  
  <span id="t_1_989">assay</span>      = <span id="t_1_992">formatAssay    ( iAssay   )</span>  
  <span id="t_1_1006">assembly</span>   = <span id="t_1_1009">formatAssembly ( iAssembly)</span>
  
  <span id="t_1_1025">URLoptions</span> &lt;- <span id="t_1_1028">paste (searchTerm, format, frame, target, type, biosample, fType, assay, assembly, sep="&")</span>
  <span id="t_1_1088">URL</span>        &lt;- <span id="t_1_1091">paste (encodePath, <span id="t_1_1099">paste( searchPath, URLoptions, sep="?")</span>, sep="")</span>
  
  <span id="t_1_1137">data</span>       &lt;- <span id="t_1_1140">fromJSON (
    <span id="t_1_1144">getURL (URL, dirlistonly = TRUE)</span>, 
    unexpected.escape = "keep"
  )</span>
  
  # Output folder
  <span id="t_1_1182">dir.create(iOut, showWarnings = FALSE)</span>
  
  # Downloads all files from the search
  for (<span id="t_1_1208">j</span> in 1:<span id="t_1_1213">length (<span id="t_1_1216">data</span>$'@graph')</span>){ 
    <span id="t_1_1230">nbFiles</span> &lt;- <span id="t_1_1233">length (<span id="t_1_1236">data</span>$'@graph'[[j]]$files)</span> 
    <span id="t_1_1260">print(<span id="t_1_1263">paste("Downloading experiment ",j, sep = "")</span>)</span>
    for (<span id="t_1_1293">i</span> in 1:<span id="t_1_1298">nbFiles</span>){
      <span id="t_1_1305">filePath</span> &lt;- <span id="t_1_1308">data</span>$'@graph'[[j]]$files[[i]]$href
      <span id="t_1_1339">curl</span> = <span id="t_1_1342">getCurlHandle()</span>
      <span id="t_1_1353">getURL (<span id="t_1_1356">paste (encodePath, filePath, sep = "")</span>, curl = curl)</span>
      <span id="t_1_1391">dn</span> &lt;- <span id="t_1_1394">getCurlInfo(curl)</span>$redirect.url # handling server redicrection
      
      # preparing to download - create project folder
      <span id="t_1_1416">fileOut</span> &lt;- <span id="t_1_1419">paste( iOut, <span id="t_1_1427">unlist( <span id="t_1_1430">strsplit( <span id="t_1_1433">data</span>$'@graph'[[j]]$'@id', "/")</span>)</span>[3], sep = "/")</span>
      <span id="t_1_1484">dir.create(fileOut, showWarnings = FALSE)</span>
      <span id="t_1_1503">fileOut</span> &lt;- <span id="t_1_1506">paste( fileOut, <span id="t_1_1514">unlist( <span id="t_1_1517">strsplit( filePath, "/")</span>)</span>[5], sep = "/")</span>
      
      # Did my user select a file format  
      if(<span id="t_1_1564">is.null(iFType)</span> || <span id="t_1_1574">data</span>$'@graph'[[j]]$files[[i]]$file_format %in% iFType){
        <span id="t_1_1610">download.file( dn, fileOut, quiet = TRUE, method = "curl")</span>
        <span id="t_1_1641">print(<span id="t_1_1644">paste("Downloaded file: ", fileOut, sep = "")</span>)</span>
      }
      
      <span id="t_1_1682">rm(curl)</span> 
    }
  }
}</pre></div><div class="tab-pane " id="tabs-2"><pre><span id="t_2_1">library("shiny")</span>

<span id="t_2_15">shinyServer(function(input, output) {
  
  <span id="t_2_29">getAssay</span>    &lt;- <span id="t_2_32">reactive({  <span id="t_2_36">input</span>$assay    })</span>
  <span id="t_2_53">getTarget</span>   &lt;- <span id="t_2_56">reactive({  <span id="t_2_60">input</span>$target   })</span>
  <span id="t_2_77">getFType</span>    &lt;- <span id="t_2_80">reactive({  <span id="t_2_84">input</span>$ftype    })</span>
  <span id="t_2_101">getSample</span>   &lt;- <span id="t_2_104">reactive({  <span id="t_2_108">input</span>$sample   })</span>
  <span id="t_2_125">getAssembly</span> &lt;- <span id="t_2_128">reactive({  <span id="t_2_132">input</span>$assembly })</span>
  <span id="t_2_149">getSearch</span>   &lt;- <span id="t_2_152">reactive({  <span id="t_2_156">input</span>$search   })</span>
  
  output$value &lt;- <span id="t_2_181">renderPrint({ 
    if(<span id="t_2_188">input</span>$downloadBt){ # trigger this function by pressing download button
      <span id="t_2_198">print("Downloading")</span>  # Does it work?
      <span id="t_2_211">encodeDownload(<span id="t_2_214">isolate(<span id="t_2_217">getSearch()</span>)</span>,
                     "experiment",
                     <span id="t_2_237">isolate(<span id="t_2_240">getTarget()</span>)</span>,
                     <span id="t_2_254">isolate(<span id="t_2_257">getSample()</span>)</span>, 
                     <span id="t_2_271">isolate(<span id="t_2_274">getFType()</span>)</span>,
                     <span id="t_2_288">isolate(<span id="t_2_291">getAssay()</span>)</span>,
                     <span id="t_2_305">isolate(<span id="t_2_308">getAssembly()</span>)</span>,
                     "encodeDownload"
      )</span>
      <span id="t_2_332">print("Downloaded")</span>  
    }else{
      <span id="t_2_351">print("Not downloaded")</span>
    }    
  })</span>
  
})</span></pre></div><div class="tab-pane " id="tabs-3"><pre><span id="t_3_1">library("shiny")</span>

<span id="t_3_15">shinyUI(<span id="t_3_18">fluidPage(
  
  <span id="t_3_23">tags</span>$head(<span id="t_3_29">tags</span>$style(<span id="t_3_35">HTML("
    .shiny-text-output {
      background-color:#fff;
    }
  ")</span>)),
  
  <span id="t_3_57">h1("Downloading", <span id="t_3_65">span("ENCODE Data", style = "font-weight: 300")</span>, 
     style = "font-family: 'Source Sans Pro';
        color: #fff; text-align: center;
        background-image: url('texturebg.png');
        padding: 20px")</span>,
  <span id="t_3_97">br()</span>,
  
  
  <span id="t_3_109">fluidRow(
    
    <span id="t_3_114">column(4,
           <span id="t_3_123">wellPanel(
             <span id="t_3_127">textInput("search", label = <span id="t_3_137">h3("Search Term")</span>, value = "")</span>
           )</span>
    )</span>,
    
    <span id="t_3_172">column(4,
           <span id="t_3_181">wellPanel(
             
             # @param assay - "ChIP-seq" "RIP-chip" "Repli-chip" 
             <span id="t_3_188">checkboxGroupInput("assay", label = <span id="t_3_198">h3("Assay")</span>, 
                                choices = <span id="t_3_213">list("ChIP-seq", "RIP-chip", "Repli-chip")</span>,
                                selected = NULL)</span>
           )</span>
    )</span>,
    <span id="t_3_258">column(4,
           <span id="t_3_267">wellPanel(
             
             # @param iTarget - "transcription factor" "RNA binding protein" "tag" "histone modification"
             <span id="t_3_274">checkboxGroupInput("target", label = <span id="t_3_284">h3("Target")</span>, 
                                choices = <span id="t_3_299">list("transcription factor",  "RNA binding protein",  "histone modification","tag")</span>,
                                selected = NULL)</span>
           )</span>
    )</span>
  )</span>,
  
  
  <span id="t_3_356">fluidRow(
    <span id="t_3_360">column(4,
           <span id="t_3_369">wellPanel(
             # @param iFType  - "bam" "bigWig" "bed_broadPeak" "broadPeak" "fastq"
             <span id="t_3_375">checkboxGroupInput("ftype", label = <span id="t_3_385">h3("File Type")</span>, 
                                choices = <span id="t_3_400">list("bam","bigWig","bed_broadPeak","broadPeak","fastq")</span>,
                                selected = NULL)</span>
             
           )</span>
    )</span>,
    
    <span id="t_3_457">column(4,
           <span id="t_3_466">wellPanel(
             # @param iSample - "tissue" "primary cell"
             <span id="t_3_472">checkboxGroupInput("sample", label = <span id="t_3_482">h3("Sample")</span>, 
                                choices = <span id="t_3_497">list("tissue","primary cell")</span>,
                                selected = NULL)</span>
           )</span>
    )</span>,
    
    <span id="t_3_538">column(4,
           <span id="t_3_547">wellPanel(
                     # @param assembly - "hg19" "mm9"
                     <span id="t_3_553">checkboxGroupInput("assembly", label = <span id="t_3_563">h3("Assembly")</span>, 
                                        choices = <span id="t_3_578">list("hg19","mm9")</span>,
                                        selected = NULL)</span>
           )</span>
    )</span>
  )</span>,
  
  <span id="t_3_624">fluidRow(
    <span id="t_3_628">column(12, 
           <span id="t_3_637">wellPanel(align = "center", style = "background-color: #4187C5",   
                     <span id="t_3_655">actionButton("downloadBt", "Download", icon=<span id="t_3_670">icon("download")</span>)</span>
           )</span>
    )</span>
  )</span>,
  <span id="t_3_702">fluidRow(<span id="t_3_705">column(5, offset = 4, <span id="t_3_720">verbatimTextOutput("value")</span>)</span>)</span>
  
  
)</span>
)</span></pre></div><div class="tab-pane " id="tabs-4"><pre></pre></div>
    </div>
    </div>
  </div>
  <div class="footer">
    <p> Generated on2015-02-11 01:08:05 by <a href="http://www.mango-solutions.com/wp/products-services/r-services/r-packages/testcoverage/">testCoverage</a>.</p>
  </div>
  </div>
</body> 
</html>
